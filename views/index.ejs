  <div id="header_bar">
    <ul>
      <li><span class="active">Home</span></li>

      <li><a href="/#!/ranking">Ranking</a></li>

      <li><a href="/#!/previous">&lt;&lt; Previous</a></li>

      <li><a href="/#!/next">Next &gt;&gt;</a></li>
    </ul>
  </div>
<!-- CODE -->
<div id="audio_player" class="jp-jplayer"></div>
<div class="jp-audio">
   <div class="jp-type-single">
      <div id="jp_interface_1" class="jp-interface">
         <ul class="jp-controls">
            <li><a href="#" class="jp-play" tabindex="1">play</a></li>
            <li><a href="#" class="jp-pause" tabindex="1">pause</a></li>
            <li><a href="#" class="jp-stop" tabindex="1">stop</a></li>
            <li><a href="#" class="jp-mute" tabindex="1">mute</a></li>
            <li><a href="#" class="jp-unmute" tabindex="1">unmute</a></li>
         </ul>
         <div class="jp-progress">
            <div class="jp-seek-bar">
               <div class="jp-play-bar"></div>
            </div>
         </div>
         <div class="jp-volume-bar">
            <div class="jp-volume-bar-value"></div>
         </div>
         <div class="jp-current-time"></div>
         <div class="jp-duration"></div>
      </div>
   </div>
</div>
<!-- / CODE -->
  <div class="block">
    <textarea class="inner" id="typing"></textarea>
  </div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> 
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
<script type="text/javascript" src="/javascripts/jquery.typing.min.js"></script>
<script type="text/javascript" src="/javascripts/jquery.jplayer.min.js"></script>
</script>
<script src="/javascripts/jquery.prettyPopin.js" type="text/javascript" charset="utf-8"></script>
<script src="/socket.io/socket.io.js" type=
  "text/javascript">
</script><script type="text/javascript">
//<![CDATA[
var stat = null;
$(document).ready(function(){
  var studyTime = 0 ,typeStart = 0, screenName = "<%= loggedIn ? session.user_profile.screen_name : '' %>";
  if("" == screenName){
    $("<a href='/static/go_twitter.html' rel='prettyPopin'></a>")
    .prettyPopin({height:300,width: 550,followScroll:false})
    .click();
    return;
  }
  $('#typing').focus();

  stat = io.connect('http://<%= title %>/status', {transports: ["xhr-polling"],port: 80 });

  stat.on('connect', function() {
    stat.emit('signin',{
      "screen_name": screenName
    });
    var signin = function(msg){
      var member = 
      $('<li class="other clearfix"/>')
      .attr("id",msg.id)
      .append($("<a />")
      .attr("href","#!/"+msg.screen_name)
      .append($("<img />")
      .attr("src","http://api.twitter.com/1/users/profile_image/"+msg.screen_name+"?size=normal"))
      .append($("<ul />")
      .append($("<li />")
      .attr("id","screen_name"+msg.id)
      .html("@"+msg.screen_name))
      .append($("<li />")
      .attr("id","status"+msg.id)
      .html(msg.status))
      ));
      $("#members").append(member);
      member
      .animate({backgroundColor:"#fdf",color:"#fff"},500)
      .animate({backgroundColor:"#fff",color:"#000"},500);
    };
    var updateStatus = function(msg,color){
      var member = $("#"+msg.id);
      var member_status = $("#status"+msg.id);
      if(member.length > 0 && member_status.length > 0){
        member_status.html(msg.status);
        if(null != color){
          member
          .animate({backgroundColor:color,color:"#fff"},500)
          .animate({backgroundColor:"#fff",color:"#000"},500);
        }
      } else {
        signin(msg);
      }
    };
    stat.on('signin', function (msg) {
      signin(msg);
    });
    stat.on('signout', function (msg) {
      var signout = $("#"+msg.id);
      if(signout.length > 0){signout.remove();}
    });
    stat.on('miss', function (msg) {
      updateStatus(msg,"#f00");
    });
    stat.on('clear', function (msg) {
      updateStatus(msg,"#0f0");
    });
    stat.on('type start', function (msg) {
      updateStatus(msg,null);
    });
    stat.on('type end', function (msg) {
      updateStatus(msg,null);
    });
    stat.on('clear', function (msg) {
      updateStatus(msg,"#0f0");
    });
    $('#typing').typing({
      start: function (event, $elem) {
          startTime = (new Date()).getTime();
          stat.emit('type start',{
            "screen_name": screenName
          });
          $elem.css('background', '#009be3')
          .css('color', '#fff');
      },
      stop: function (event, $elem) {
          studyTime += (new Date()).getTime() - startTime;
          stat.emit('type end',{
            "screen_name": screenName,
            "studyTime"  : studyTime
          });
          var sec = parseInt(parseInt(studyTime)/1000);
          
          var hour= parseInt(sec/(60 * 60));
          if(hour > 0 ){sec    %= (hour * 60 * 60);}
          
          var min = parseInt(sec/60);
          if(min > 0 ){sec    %= (min * 60);}
          
          if(hour< 10){hour = "0"+hour};
          if(min < 10){min  = "0"+min};
          if(sec < 10){sec  = "0"+sec};
          $("#study_time").html('STUDY: '+hour+":"+min+":"+sec);
          $elem.css('background', '#ddd')
          .css('color', '#666')
      },
      delay: 1000
    });
    $("#audio_player").jPlayer({
       ready: function(){
          $(this).jPlayer("setMedia", {
             //mp3: "http://englishplactice.appspot.com/apis/tts.mp3?q=We+must+respect+the+will+of+the+individual."
             mp3: "http://www.sousound.com/music/mondo_lounge/mondo_01.mp3"
          }).jPlayer("play");
       },
       preload: "auto",
       volume: 1.0,
       muted: false,
       backgroundColor: "#eee",
       errorAlerts:false,
       warningAlerts:false,
       ended: function (event) {
          $(this).jPlayer("play");
       },
       swfPath: "/swfs/",
       solution: 'html, flash',
       supplied: "mp3, m4a, oga"
    })
    .bind($.jPlayer.event.play, function() {
       $(this).jPlayer("pauseOthers");
    });
  });
});
  //]]>
  </script>

